// pnltri.js / raw.github.com/jahting/pnltri.js/master/LICENSE
'use strict';var r={ea:"1.4"};r.f={random:Math.random,fa:function(a){for(var b=a.length-1;0<b;b--){var c=Math.floor(r.f.random()*(b+1)),e=a[b];a[b]=a[c];a[c]=e}return a},V:function(a,b,c){return(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)},ca:function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},ha:function(a,b){return a.x*b.x+a.y*b.y},ga:function(a,b){return a.x*b.y-b.x*a.y},ia:function(a,b,c){b={x:b.x-a.x,y:b.y-a.y};a={x:c.x-a.x,y:c.y-a.y};c=r.f.ha(b,a)/r.f.ca(b)/r.f.ca(a);return 0<=r.f.ga(b,a)?1-c:3+c},R:function(a,b){var c=a.y-b.y;if(c<
r.f.D)return-1;if(c>r.f.m)return 1;c=a.x-b.x;return c<r.f.D?-1:c>r.f.m?1:0}};r.f.m=Math.pow(2,-43);r.f.D=-r.f.m;function v(a){this.da=[];this.p=[];this.M=0;this.F=[];this.n=[];this.W=[];if(a)for(var b=0,c=a.length;b<c;b++){var e=w(this,a[b]);if(3>e.length)console.log("Polygon has < 3 vertices!",e);else{for(var d=void 0,h=void 0,g=void 0,f=0;f<e.length-1;f++)d=A(this,e[f],e[f+1]),g?(d.q=g,g.l=d):h=d,g=d,this.p.push(d);d=A(this,e[e.length-1],e[0]);d.q=g;g.l=d;this.p.push(d);h.q=d;d.l=h;this.F[this.M++]=!0}}}v.prototype={S:function(){return this.F.concat()}};function C(a,b,c,e){a.W.push([b.id,c.id,e.id])}
function D(a,b,c,e,d){var h=E(c,e).O,g=E(e,c).O,f=F(a,{b:c,k:e,K:!0,h:h.h,g:g});c=F(a,{b:e,k:c,K:!1,h:g.h,g:h});h.h.g=f;g.h.g=c;h.h=c;g.h=f;h=a.n.length;d?(a.n[b]=f,a.n[h]=c):(a.n[b]=c,a.n[h]=f);return h}function E(a,b){for(var c,e,d=null,h=4,g=0;g<a.u.length;g++)c=a.u[g],(e=r.f.ia(a,c.X,b))<h&&(h=e,d=c);return d}function F(a,b){a.p.push(b);b.b.u.push({O:b,X:b.k});return b}
function w(a,b){function c(a,b){return Math.abs(a.x-b.x)<r.f.m&&Math.abs(a.y-b.y)<r.f.m}for(var e=[],d,h,g,f=0;f<b.length;f++)d=G(a,b[f].x,b[f].y),h=!0,g=e.length-1,0<=g&&c(d,e[g])&&(h=!1),h&&e.push(d);1<e.length&&c(e[e.length-1],e[0])&&e.pop();return e}function A(a,b,c){return{Q:a.M,b:b,k:c,K:1==r.f.R(c,b),q:null,l:null,G:null,H:null,t:!1,I:null,J:null,h:null,g:null,T:!1}}function G(a,b,c){b={id:a.da.length,x:b,y:c,u:[]};a.da.push(b);return b};function H(a){this.i=a}H.prototype={};function I(a,b,c,e){this.C=a?a:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY};this.j=b?b:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY};this.o=c;this.r=e;this.depth=-1;this.U=!1}I.prototype={};function J(a){var b=new I(a.C,a.j,a.o,a.r);b.d=a.d;b.e=a.e;b.a=a.a;b.c=a.c;b.s=a.s;return b}function K(a){this.w=a;a.s=this}K.prototype={};
function L(a){var b=new I(null,null,null,null);this.A=[];M(this,b);this.root=new K(b);if(a)for(a=a.p,b=0;b<a.length;b++)a[b].G=a[b].H=this.root,a[b].t=!1}L.prototype={L:function(){for(var a,b=0,c=this.A.length;b<c;b++)if(a=this.A[b],1==a.depth%2&&!a.U&&(!a.d&&!a.e||!a.a&&!a.c)&&a.o)return a;return null}};
function O(a,b){function c(){var a=m.d||m.e;a.a&&a.c?m==a.a?(n.d=null,a.a=q):(q.e=null,a.c=n):(n.d=null,n.e=a,a.c=n)}function e(a){m.j==t.j?(p?m.a?(a.d=q,q.a=a,n.c=null):(a.e=n,q.a=null,n.c=a):(a.d=q,a.e=n,q.a=n.c=a),q.c=n.a=null):(a.d&&a.e&&(a.d==m?(a.B=a.e,a.ba=!0):(a.B=a.d,a.ba=!1)),a.d=q,a.e=n,q.c=n.a=a,q.a=n.c=null)}function d(){var a;m.j==t.j&&p?(m.a.d=q,m.c.e=n,q.a=m.a,n.c=m.c,a=q.c=n.a=null):(m.a.d=q,m.c.e=n,0<P(b,m.j)?(a=m.c,m.c.d=q,q.a=m.a,n.c=null):(a=m.a,m.a.e=n,n.c=m.c,q.a=null),q.c=
n.a=a);return a}var h,g,f,k,l,p;b.K?(k=b.b,h=b.k,l=b.G,g=b.H,p=b.q.t,f=b.l.t):(k=b.k,h=b.b,l=b.H,g=b.G,p=b.l.t,f=b.q.t);g=Q(h,k,g);f||(g=R(a,g,h,!1));f=g.w;if(f.d||f.e){g=Q(k,h,l);p||(g=R(a,g,k,!0));var t=g.w,m=f,q,n,x,u;for(h=a.A.length+2;m;){if(0>--h){console.log("ERR add_segment: infinite loop",m,b,a);return}if(!m.a&&!m.c){console.log("ERR add_segment: missing successors",m,b,a);return}k=m.s;k.v=b;k.w=null;u&&u.r==m.r?(q=m,n=u,n.j=m.j,k.left=new K(q),k.right=u.s):(x&&x.o==m.o?(n=m,q=x,q.j=m.j,
k.left=x.s):(q=m,n=W(a,m),k.left=new K(q)),k.right=new K(n));m.d&&m.e?m.B?(m.ba?(n.d=m.e,n.e=m.B,n.d.a=n,n.e.c=n):(q.e=m.d,q.d=m.B,q.d.a=q,q.e.c=q),q.B=n.B=null):m.C==f.C?(n.e.c=n,q.e=n.d=null):n==m?(n.d=n.e,n.e=null,n.d.a=n):(q.e=q.d,q.d=null):c();m.a&&m.c?k=d():(k=m.a?m.a:m.c,e(k));q.r&&(q.r.I=n);n.o&&(n.o.J=q);q.r=n.o=b;b.I=q;b.J=n;m.j!=t.j?(x=q,u=n,m=k):m=null}b.t=!0}else console.log("ERR add_segment: missing trFirst.uX: ",f)}
function Q(a,b,c){for(var e;c;)if(c.Y)e=a==c.Y?b:a,e=r.f.R(e,c.Y),c=-1==e?c.left:c.right;else if(c.v)a==c.v.b||a==c.v.k?Math.abs(a.y-b.y)<r.f.m?c=b.x<a.x?c.left:c.right:(e=P(c.v,b),c=0<e?c.left:0>e?c.right:a==c.v.b?c.right:c.left):(e=a,e=P(c.v,e),c=0<e?c.left:c.right);else return c.w||console.log("ptNode: unknown type",c),c}
function P(a,b){var c,e;e=a.b.x-b.x;var d=a.k.x-b.x;if(Math.abs(a.k.y-b.y)<r.f.m)c=d;else if(Math.abs(a.b.y-b.y)<r.f.m)c=e,e=d;else return a.K?r.f.V(a.b,a.k,b):r.f.V(a.k,a.b,b);return Math.abs(c)<r.f.m?Math.abs(e)<r.f.m?0:e:c}function R(a,b,c,e){var d=b.w;if(d.C==c||d.j==c)return b;var h=J(d);d.j=h.C=c;d.a=h;h.d=d;d.c=h.e=null;h.a&&(h.a.d=h);h.c&&(h.c.e=h);M(a,h);b.Y=c;b.w=null;b.right=new K(d);b.left=new K(h);return e?d.s:h.s}function W(a,b){var c=J(b);M(a,c);return c}
function M(a,b){b.ka=a.A.length;a.A.push(b)}function X(a){this.i=a;this.$=new L(this.i)}X.prototype={L:function(){return this.$.L()}};function Y(a){this.i=a;this.aa=this.P=null}Y.prototype={};
function aa(a,b,c){var e=null,d=null;function h(){var a;return(a=g.pop())?(f=a[0],k=a[1],l=a[2],p=a[3],!0):!1}var g=[],f,k,l,p,t;null==e&&(d=!0,c.d?e=!0:c.a?e=!1:(d=!1,e=c.e?!0:!1));for(c&&g.push([c,e,d,b]);h();)if(!f.U){f.U=!0;if(!f.o||!f.r){console.log("ERR alyTrap: lseg/rseg missing",f);break}k?l?(b=f.d,c=f.e,e=f.a,d=f.c):(b=f.e,c=f.d,e=f.c,d=f.a):l?(b=f.a,c=f.c,e=f.d,d=f.e):(b=f.c,c=f.a,e=f.e,d=f.d);if(c||d)t=D(a.i,p,f.j,f.C,l);d&&g.push([d,k,!l,t]);c&&g.push([c,!k,!l,t]);e&&g.push([e,k,l,p]);
e||d||b&&g.push([b,!k,l,p])}};function Z(a){this.i=a}Z.prototype={};function $(){this.N=null}
$.prototype={Z:function(){this.N=null},S:function(){return this.N?this.N.S():null},ja:function(a,b){this.Z();if(!a||0==a.length)return[];var c=new v(a),e=b?!1:1==c.M;if(e){e=new H(c);a:{var d=e.i,h=d.p[0],g=h,f=h,k=0;do k+=(f.b.x-f.k.x)*(f.b.y+f.k.y),f=f.l;while(f!=h);if(0>k){do g.h=g.l,g=g.g=g.q;while(g!=h);d.F[0]=!1}else{do g.h=g.q,g=g.g=g.l;while(g!=h)}for(h=d=h;d.g!=d.h;){b:{var g=d.h.b.x,f=d.h.b.y,k=d.b.x,l=d.b.y,p=d.g.b.x,t=d.g.b.y,m=p-k,q=t-l,n=g-p,x=f-t,u=k-g,N=l-f;if(r.f.m>u*q-m*N)g=!1;else{for(var ba=
d.h.h,B=d.g;B!=ba;){var B=B.g,y=B.b.x,z=B.b.y,S=y-g,T=z-f;if(0!=S||0!=T){var U=y-k,V=z-l;if(0!=U||0!=V)if(y-=p,z-=t,(0!=y||0!=z)&&m*V-q*U>=r.f.D&&u*T-N*S>=r.f.D&&n*z-x*y>=r.f.D){g=!1;break b}}}g=!0}}if(g)C(e.i,d.h.b,d.b,d.g.b),d.h.g=d.g,d.g.h=d.h,h=d=d.g;else if(d=d.g,d==h){e=!1;break a}}e=!0}}if(!e){e=new Y(c);e.P=new X(e.i);h=e.P;d=h.i.p.concat();r.f.fa(d);g=0;f=h.i.M;if(1!=f)for(k=Array(f),l=d.concat(),p=0;p<l.length;p++)t=l[p].Q,k[t]?d[f++]=l[p]:(d[g++]=l[p],k[t]=!0);g=d.length;f=h.$;k=0;for(l=
g;k<g;){l=Math.log(l)/Math.LN2;for(p=1<l?Math.floor(g/l):g;k<p;k++)O(f,d[k]);for(p=k;p<g;p++)t=d[p],t.G=Q(t.b,t.k,t.G),t.H=Q(t.k,t.b,t.H)}var h=h.i,f=[f.A[0]],k=[],s,p=0;do{for(t=1==p%2;l=f.pop();)-1==l.depth&&(l.depth=p,l.d&&f.push(l.d),l.e&&f.push(l.e),l.a&&f.push(l.a),l.c&&f.push(l.c),(s=l.o)&&-1==s.I.depth&&k.push(s.I),s=l.r)&&(-1==s.J.depth&&k.push(s.J),s.K!=t&&(h.F[s.Q]=!1));f=k;k=[];p++}while(0<f.length);for(p=0;p<g;p++)d[p].I=d[p].J=null;e.aa=e.P.L();s=e.i;for(h=0;h<s.p.length;h++)d=s.p[h],
s.F[d.Q]?(d.h=d.q,d.g=d.l,d.b.u.push({O:d,X:d.k})):(d=d.l,d.h=d.l,d.g=d.q,d.b.u.push({O:d,X:s.p[h].b}));for(s=e.aa;s;)d=aa,h=e,g=e.i,f=g.n.length,g.n[f]=s.o,d(h,f,s),s=e.P.L();s=e.i;k=[];for(l=0;l<s.n.length;l++){e=d=s.n[l];g=f=e.b;e.T=!0;e=e.g;for(p=!1;(h=e.b)!=g;){if(e.T){p=!0;break}else e.T=!0;1==r.f.R(h,f)&&(f=h,d=e);e=e.g}p||k.push(d)}s.n=k;s=e=new Z(c);e=s.i.n;s.i.W=[];for(d=0;d<e.length;d++)if(f=e[d],h=f.h,g=f.g,g.g==h)C(s.i,f.b,g.b,h.b);else if(h=s,g=f.g,f=f.b,k=[g.b],l=0,g=g.g,p=g.b,p!=f){for(;p!=
f||1<l;)if(0<l)if(0<r.f.V(p,k[l-1],k[l]))C(h.i,k[l-1],k[l],p),l--;else if(k[++l]=p,p==f)for(console.log("ERR uni-y-monotone: only concave angles left",k);1<l;)l--,C(h.i,k[l-1],k[l],k[l+1]);else g=g.g,p=g.b;else k[++l]=p,g=g.g,p=g.b;C(h.i,k[l-1],k[l],p)}s=c.p;for(e=0;e<s.length;e++)s[e].b.u=null}this.N=c;return c.W.concat()}};window.PNLTRI=r;r.REVISION=r.ea;r.Triangulator=$;$.prototype.clear_lastData=$.prototype.Z;$.prototype.get_PolyLeftArr=$.prototype.S;$.prototype.triangulate_polygon=$.prototype.ja;
